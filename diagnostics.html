<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Diagnostics: Spans and Observers &mdash; Baseplate</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Baseplate" href="index.html" />
    <link rel="next" title="Serving requests: baseplate-serve" href="server.html" />
    <link rel="prev" title="Quick Start" href="quickstart.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="diagnostics-spans-and-observers">
<h1>Diagnostics: Spans and Observers<a class="headerlink" href="#diagnostics-spans-and-observers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="spans">
<h2>Spans<a class="headerlink" href="#spans" title="Permalink to this headline">¶</a></h2>
<p>The heart of Baseplate is its diagnostics system.</p>
<p>At the root of each application is a single instance of
<a class="reference internal" href="api/baseplate/core.html#baseplate.core.Baseplate" title="baseplate.core.Baseplate"><tt class="xref py py-class docutils literal"><span class="pre">Baseplate</span></tt></a>. Each time a new request comes in to be
served, the time taken to handle the request is represented by a new
<a class="reference internal" href="api/baseplate/core.html#baseplate.core.RootSpan" title="baseplate.core.RootSpan"><tt class="xref py py-class docutils literal"><span class="pre">RootSpan</span></tt></a> instance. During the course of handling
that request, the local service might make calls to remote services or do
expensive calculations, the time spent in these actions is represented by child
<a class="reference internal" href="api/baseplate/core.html#baseplate.core.Span" title="baseplate.core.Span"><tt class="xref py py-class docutils literal"><span class="pre">Span</span></tt></a> instances.</p>
<p>Spans have names and IDs and track their parent relationships. When calls are
made to remote services, the information that identifies the local child span
representing that service call is passed along to the remote service and
becomes the root span in the remote service. This allows requests to be traced
across the infrastructure.</p>
<p>Small bits of data, called annotations, can be attached to spans as well. This
could be the URL fetched, or how many items were sent in a batch, or whatever
else might be helpful.</p>
</div>
<div class="section" id="observers">
<h2>Observers<a class="headerlink" href="#observers" title="Permalink to this headline">¶</a></h2>
<p>To actually do something with all these spans, Baseplate provides observer
interfaces which receive notification of events happening in the application
via calls to various methods.</p>
<p>The base type of observer is <a class="reference internal" href="api/baseplate/core.html#baseplate.core.BaseplateObserver" title="baseplate.core.BaseplateObserver"><tt class="xref py py-class docutils literal"><span class="pre">BaseplateObserver</span></tt></a>
which can be registered with the root <a class="reference internal" href="api/baseplate/core.html#baseplate.core.Baseplate" title="baseplate.core.Baseplate"><tt class="xref py py-class docutils literal"><span class="pre">Baseplate</span></tt></a>
instance using the <a class="reference internal" href="api/baseplate/core.html#baseplate.core.Baseplate.register" title="baseplate.core.Baseplate.register"><tt class="xref py py-meth docutils literal"><span class="pre">register()</span></tt></a> method.
Whenever a new root span is created in your application (i.e. a new request
comes in to be served) the observer has its
<a class="reference internal" href="api/baseplate/core.html#baseplate.core.BaseplateObserver.on_root_span_created" title="baseplate.core.BaseplateObserver.on_root_span_created"><tt class="xref py py-meth docutils literal"><span class="pre">on_root_span_created()</span></tt></a> method called
with the relevant details. If this method returns an instance of
<a class="reference internal" href="api/baseplate/core.html#baseplate.core.RootSpanObserver" title="baseplate.core.RootSpanObserver"><tt class="xref py py-class docutils literal"><span class="pre">RootSpanObserver</span></tt></a>, the returned observer will be
registered to receive events from the new root span.</p>
<p>Spans, and root spans, can be notified of three common events:
<a class="reference internal" href="api/baseplate/core.html#baseplate.core.SpanObserver.on_start" title="baseplate.core.SpanObserver.on_start"><tt class="xref py py-meth docutils literal"><span class="pre">on_start()</span></tt></a>,
<a class="reference internal" href="api/baseplate/core.html#baseplate.core.SpanObserver.on_annotate" title="baseplate.core.SpanObserver.on_annotate"><tt class="xref py py-meth docutils literal"><span class="pre">on_annotate()</span></tt></a>, and
<a class="reference internal" href="api/baseplate/core.html#baseplate.core.SpanObserver.on_stop" title="baseplate.core.SpanObserver.on_stop"><tt class="xref py py-meth docutils literal"><span class="pre">on_stop()</span></tt></a>. These represent the span
starting, having a custom annotation added, and ending, respectively.</p>
<p>Additionally, <a class="reference internal" href="api/baseplate/core.html#baseplate.core.RootSpanObserver" title="baseplate.core.RootSpanObserver"><tt class="xref py py-class docutils literal"><span class="pre">RootSpanObserver</span></tt></a> has one extra event,
<a class="reference internal" href="api/baseplate/core.html#baseplate.core.RootSpanObserver.on_child_span_created" title="baseplate.core.RootSpanObserver.on_child_span_created"><tt class="xref py py-meth docutils literal"><span class="pre">on_child_span_created()</span></tt></a>. This method
is called when a new child span is created in the application for e.g. a call
to a remote service or an expensive computation. If this method returns an
instance of <a class="reference internal" href="api/baseplate/core.html#baseplate.core.SpanObserver" title="baseplate.core.SpanObserver"><tt class="xref py py-class docutils literal"><span class="pre">SpanObserver</span></tt></a>, the returned observer
will be registered to receive events from the new child span.</p>
<p>It&#8217;s up to the observers to attach meaning to these events. For example, the
metrics observer would start a timer
<tt class="xref py py-meth docutils literal"><span class="pre">on_start()</span></tt> and record the elapsed time to
statsd <tt class="xref py py-meth docutils literal"><span class="pre">on_stop()</span></tt>.</p>
</div>
<div class="section" id="convenience">
<h2>Convenience<a class="headerlink" href="#convenience" title="Permalink to this headline">¶</a></h2>
<p>Baseplate comes with some core monitoring observers built in and just requires
you to configure them. You can enable them by calling the relevant methods on
your application&#8217;s <a class="reference internal" href="api/baseplate/core.html#baseplate.core.Baseplate" title="baseplate.core.Baseplate"><tt class="xref py py-class docutils literal"><span class="pre">baseplate.core.Baseplate</span></tt></a> object.</p>
<ul class="simple">
<li>Logging: <a class="reference internal" href="api/baseplate/core.html#baseplate.core.Baseplate.configure_logging" title="baseplate.core.Baseplate.configure_logging"><tt class="xref py py-meth docutils literal"><span class="pre">configure_logging()</span></tt></a></li>
<li>Metrics (statsd): <a class="reference internal" href="api/baseplate/core.html#baseplate.core.Baseplate.configure_metrics" title="baseplate.core.Baseplate.configure_metrics"><tt class="xref py py-meth docutils literal"><span class="pre">configure_metrics()</span></tt></a></li>
</ul>
<p>Additionally, Baseplate provides helpers which can be attached to the
<a class="reference internal" href="glossary.html#term-context-object"><em class="xref std std-term">context object</em></a> in requests. These helpers make the passing of trace
information and collection of spans automatic and transparent. Because this
pattern is so common, Baseplate has a special kind of observer for it which can
be registered with <a class="reference internal" href="api/baseplate/core.html#baseplate.core.Baseplate.add_to_context" title="baseplate.core.Baseplate.add_to_context"><tt class="xref py py-meth docutils literal"><span class="pre">add_to_context()</span></tt></a>. See the
<a class="reference internal" href="api/baseplate/context/index.html#module-baseplate.context" title="baseplate.context"><tt class="xref py py-mod docutils literal"><span class="pre">baseplate.context</span></tt></a> package for a list of helpers included.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/baseplate.png" alt="Logo"/>
    
  </a>
</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Diagnostics: Spans and Observers</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Serving requests: baseplate-serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="quickstart.html" title="previous chapter">Quick Start</a></li>
      <li>Next: <a href="server.html" title="next chapter">Serving requests: baseplate-serve</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      <a href="_sources/diagnostics.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>